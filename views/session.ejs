<div style="display: flex; min-height: 100vh;">
    <%- include('layouts/nav') %>
  
    <main class="container py-4" style="flex-grow: 1;">
      <!-- Header -->
      <%- include('layouts/header-main') %>
  
      <!-- Summary Sesi -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card text-white bg-info">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <h5 class="card-title">Ringkasan Sesi</h5>
                <%
                  // Hitung total, aktif, selesai
                  const totalSesi = sessions.length;
                  const now = new Date();
                  let aktif = 0, selesai = 0;
                  sessions.forEach(s => {
                    if (new Date(s.as_start_time) <= now && new Date(s.as_end_time) >= now) {
                      aktif++;
                    } else {
                      selesai++;
                    }
                  });
                %>
                <p class="card-text mb-0">
                  Total Sesi: <strong><%= totalSesi %></strong>
                  | Aktif: <strong><%= aktif %></strong>
                  | Selesai: <strong><%= selesai %></strong>
                </p>
              </div>
              <!-- <a href="#" class="btn btn-light">Tambah Sesi</a> -->
              <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#modalTambahSesi">
                <i class="bi bi-plus"></i> Tambah Sesi
              </button>   
            </div>
          </div>
        </div>
      </div>

      <!-- Modal Tambah sesi -->
    <div class="modal fade" id="modalTambahSesi" tabindex="-1" aria-labelledby="modalTambahSesiLabel" aria-hidden="true">
      <div class="modal-dialog">
        <form action="/session/add" method="POST" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTambahSesiLabel">Tambah Sesi Presensi</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="as_name" class="form-label">Nama sesi</label>
              <input type="text" name="as_name" class="form-control" id="as_name" required>
            </div>
            <div class="mb-3">
              <label for="as_type" class="form-label">Session Type</label>
              <select name="as_type" id="as_type" class="form-select" required>
                <!-- <option value="">Select Type</option> -->
                <option value="class">Class</option>
                <option value="event">Event</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="as_start_time" class="form-label">Waktu Mulai</label>
              <input type="datetime-local" name="as_start_time" class="form-control" id="as_start_time" required>
            </div>
            <div class="mb-3">
              <label for="as_end_time" class="form-label">Waktu Berakhir</label>
              <input type="datetime-local" name="as_end_time" class="form-control" id="as_end_time" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Simpan</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          </div>
        </form>
      </div>
    </div>
  
      <!-- Filter & Search -->
      <div class="row mb-3 align-items-end">
        <div class="col-md-4">
          <label for="searchInput" class="form-label">Cari Sesi</label>
          <input type="text" id="searchInput" class="form-control" placeholder="Cari berdasarkan nama atau kelas...">
        </div>
        <div class="col-md-4">
          <label for="sortDropdown" class="form-label">Diurutkan</label>
          <select id="sortDropdown" class="form-select">
            <option value="waktu-desc">Waktu Terbaru</option>
            <option value="waktu-asc">Waktu Terlama</option>
            <option value="kelas-asc">Nama Sesi (A-Z)</option>
            <option value="kelas-desc">Nama Sesi (Z-A)</option>
          </select>
        </div>
        <div class="col-md-4">
          <label for="statusFilter" class="form-label">Filter Status</label>
          <select id="statusFilter" class="form-select">
            <option value="all">Semua</option>
            <option value="active">Aktif</option>
            <option value="inactive">Nonaktif</option>
          </select>
        </div>
      </div>
  
      <!-- Daftar Sesi (Tabel) -->
        <div class="table-responsive mb-4" id="tableWrapper">
            <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark" style="position: sticky; top: 0; z-index: 1;">
            <tr>
              <th>#</th>
              <th>Nama Sesi</th>
              <th>Jenis</th>
              <th>Mulai</th>
              <th>Berakhir</th>
              <th>Status</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="sessionTableBody">
            <% sessions.forEach((session, index) => { %>
            <tr>
              <td><%= index + 1 %></td>
              <td><%= session.as_name %></td>
              <td><%= session.as_type === 'class' ? 'Kelas' : 'Acara' %></td>
              <td><%= session.as_start_time %></td>
              <td><%= session.as_end_time %></td>
              <td>
                <% if (new Date(session.as_start_time) <= new Date() && new Date(session.as_end_time) >= new Date()) { %>
                  <span class="badge bg-success">Aktif</span>
                <% } else { %>
                  <span class="badge bg-secondary">Selesai</span>
                <% } %>
              </td>
              <td>
                <a href="/session_monitor/<%= session.as_id %>" class="btn btn-sm btn-primary">Pantau</a>
              </td>
            </tr>
            <% }); %>
            </tbody>
        </table>
        </div>
    </main>
  </div>
  
<script>
    document.addEventListener("DOMContentLoaded", function () {
      const tableBody = document.getElementById("sessionTableBody");
      const rows = tableBody.getElementsByTagName("tr");
  
      if (rows.length > 10) {
        const tableWrapper = document.getElementById("tableWrapper");
        tableWrapper.style.maxHeight = "500px";
        tableWrapper.style.overflowY = "auto";
        tableWrapper.style.border = "1px solid #dee2e6"; // opsional: style tambahan
      }
    });
  </script>